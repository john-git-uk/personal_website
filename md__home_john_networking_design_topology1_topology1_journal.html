<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Networking Design - Johnathan Moore: Topology 1 Journal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
       <script type="text/javascript">
           DoxygenAwesomeDarkModeToggle.init()
       </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Networking Design - Johnathan Moore
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__home_john_networking_design_topology1_topology1_journal.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Topology 1 Journal </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md29"></a>
Proprietary Software Requirements</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
Cisco IOS</h2>
<p >The Cisco IOS versions I am using are IOL for almost all the devices. These images only have ethernet 10Mbps ports virtualised. I have a cloud router image for R1, so I can practice more advanced topics IOL doesn't support, for example REST config. </p>
<h1><a class="anchor" id="autotoc_md31"></a>
Topology Summary</h1>
<p >This topology has two sites. The topology represents a DIY retailer named TapeItUp. This company uses in-store web catalogues to compliment customer browsing. There is a main and outreach site.</p>
<p >domain name = TapeItUp</p>
<p >The main site has at a minimum: </p><div class="fragment"><div class="line">10 sales pcs</div>
<div class="line">12 guest pcs</div>
<div class="line">2 supervisor pcs at either end of the store</div>
<div class="line">1 accounting pc</div>
<div class="line">1 http server</div>
<div class="line">1 aaa server</div>
<div class="line">wifi for guest and sales</div>
</div><!-- fragment --><p> The outreach site has at a minimum: </p><div class="fragment"><div class="line">3 sales pcs</div>
<div class="line">5 guest pcs</div>
<div class="line">1 supervisor pc</div>
</div><!-- fragment --><p> The two sties must be able to securely communicate through their broadband ISP. The main site must have two redundant paths to their broadband ISP.</p>
<p >All devices have their hostname configured. </p>
<h1><a class="anchor" id="autotoc_md32"></a>
Topology Data</h1>
<h2><a class="anchor" id="autotoc_md33"></a>
Container Pulls</h2>
<div class="fragment"><div class="line">adosztal/net_toolbox</div>
<div class="line">adosztal/aaa</div>
<div class="line">adosztal/dns</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md34"></a>
All Container Config</h2>
<div class="fragment"><div class="line">ln -sf /usr/share/zoneinfo/Europe/London /etc/localtime</div>
<div class="line">echo &quot;Europe/London&quot; &gt; /etc/timezone</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md35"></a>
ISP IPv4 Contract</h2>
<p >These /32 host addresses are assigned by lab ISP </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Link   </th><th class="markdownTableHeadCenter">Inside Global   </th><th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter">ISP Interface    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">R3-ISP   </td><td class="markdownTableBodyCenter">10.10.10.30   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">10.10.10.31    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">R1-ISP   </td><td class="markdownTableBodyCenter">10.10.10.10   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">10.10.10.11    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">R2-ISP   </td><td class="markdownTableBodyCenter">10.10.10.20   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">10.10.10.21   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md36"></a>
Loopbacks IPv4 192.168.2.0/26</h2>
<div class="fragment"><div class="line">R1 192.168.2.1</div>
<div class="line">R2 192.168.2.2</div>
<div class="line">R3 192.168.2.3</div>
<div class="line">SW3 192.168.2.13</div>
<div class="line">SW4 192.168.2.14</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md37"></a>
IPv4 Links in subnet 192.168.2.64/26</h2>
<h3><a class="anchor" id="autotoc_md38"></a>
(.64 to .127) subnetted /31</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">R1-SW3   </td><td class="markdownTableBodyCenter">192.168.2.64   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.2.65    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">R2-SW4   </td><td class="markdownTableBodyCenter">192.168.2.66   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.2.67    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">R1-R3 VPN   </td><td class="markdownTableBodyCenter">192.168.2.68   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.2.69    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">R2-R3 VPN   </td><td class="markdownTableBodyCenter">192.168.2.70   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.2.71    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">R1-SW4   </td><td class="markdownTableBodyCenter">192.168.2.72   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.2.73    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">R2-SW3   </td><td class="markdownTableBodyCenter">192.168.2.74   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.2.75   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md39"></a>
Vlans &amp; IPv4</h2>
<p >Native VLAN = 933</p>
<h3><a class="anchor" id="autotoc_md40"></a>
vlan 10 sales 192.168.10.0/25 192.168.10.128/25</h3>
<p >126 usable addresses </p><div class="fragment"><div class="line">main: 192.168.10.0/25</div>
<div class="line">SW3SVI: 192.168.10.124</div>
<div class="line">SW4SVI: 192.168.10.125</div>
<div class="line">HSRP-gate: 192.168.10.126</div>
<div class="line">outreach: 192.168.10.128/25</div>
<div class="line">gateway: 192.168.10.254</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md41"></a>
vlan 20 guest 192.168.20.0/23 192.168.22.0/24</h3>
<p >510 usable addresses &amp; 254 usable addresses </p><div class="fragment"><div class="line">main: 192.168.20.0/23</div>
<div class="line">SW3SVI: 192.168.21.252</div>
<div class="line">SW4SVI: 192.168.21.253</div>
<div class="line">HSRP-gate: 192.168.21.254</div>
<div class="line">outreach: 192.168.22.0/24</div>
<div class="line">gateway: 192.168.22.254</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md42"></a>
vlan 30 management 192.168.30.0/25 192.168.30.128/25</h3>
<p >126 usable addresses </p><div class="fragment"><div class="line">main: 192.168.30.0/25</div>
<div class="line">management_server: 192.168.30.123</div>
<div class="line">SW1SVI: 192.168.30.1</div>
<div class="line">SW2SVI: 192.168.30.2</div>
<div class="line">SW3SVI: 192.168.30.3</div>
<div class="line">SW4SVI: 192.168.30.4</div>
<div class="line">SW5SVI: 192.168.30.5</div>
<div class="line">SW6SVI: 192.168.30.6</div>
<div class="line">Site1_HSRP-gate: 192.168.30.126</div>
<div class="line">outreach: 192.168.30.128/25</div>
<div class="line">SW7SVI: 192.168.30.137</div>
<div class="line">Site2_Gateway: 192.168.30.254</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md43"></a>
vlan 40 supervisor 192.168.40.0/25 192.168.40.128/25</h3>
<p >126 usable addresses </p><div class="fragment"><div class="line">main: 192.168.40.0/25</div>
<div class="line">SW3SVI: 192.168.40.124</div>
<div class="line">SW4SVI: 192.168.40.125</div>
<div class="line">HSRP-gate: 192.168.40.126</div>
<div class="line">outreach: 192.168.40.128/25</div>
<div class="line">gateway: 192.168.40.254</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md44"></a>
vlan 60 guest-services 192.168.60.0/24</h3>
<p >254 usable addresses </p><div class="fragment"><div class="line">main: 192.168.60.0/24</div>
<div class="line">dns_server: 192.168.60.250</div>
<div class="line">web_server: 192.168.60.251</div>
<div class="line">SW3SVI: 192.168.60.252</div>
<div class="line">SW4SVI: 192.168.60.253</div>
<div class="line">HSRP-gate: 192.168.60.254</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md45"></a>
vlan 70 internal-services 192.168.70.0/24</h3>
<p >254 usable addresses </p><div class="fragment"><div class="line">main: 192.168.70.0/24</div>
<div class="line">aaa_server 192.168.70.251</div>
<div class="line">SW3SVI: 192.168.70.252</div>
<div class="line">SW4SVI: 192.168.70.253</div>
<div class="line">HSRP-gate: 192.168.70.254</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md46"></a>
vlan 80 accounting 192.168.80.0/24</h3>
<p >254 usable addresses </p><div class="fragment"><div class="line">main: 192.168.80.0/24</div>
<div class="line">SW3SVI: 192.168.80.252</div>
<div class="line">SW4SVI: 192.168.80.253</div>
<div class="line">HSRP-gate: 192.168.80.254</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md47"></a>
IPv4 DHCP pools</h2>
<h3><a class="anchor" id="autotoc_md48"></a>
Main Site:</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Subnet   </th><th class="markdownTableHeadCenter">Exclusion Start   </th><th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter">Exclusion End    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">192.168.10.0/25   </td><td class="markdownTableBodyCenter">192.168.10.120   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.10.127    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">192.168.20.0/23   </td><td class="markdownTableBodyCenter">192.168.21.245   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.21.255    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">192.168.30.0/25   </td><td class="markdownTableBodyCenter">192.168.30.120   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.30.127    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">192.168.40.0/25   </td><td class="markdownTableBodyCenter">192.168.40.120   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.40.127    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">192.168.60.0/24   </td><td class="markdownTableBodyCenter">192.168.60.225   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.60.255    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">192.168.70.0/24   </td><td class="markdownTableBodyCenter">192.168.70.225   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.70.255    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">192.168.80.0/24   </td><td class="markdownTableBodyCenter">192.168.80.225   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.80.255   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md49"></a>
Outreach Site:</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Subnet   </th><th class="markdownTableHeadCenter">Exclusion Start   </th><th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter">Exclusion End    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">192.168.10.128/25   </td><td class="markdownTableBodyCenter">192.168.10.250   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.10.255    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">192.168.22.0/24   </td><td class="markdownTableBodyCenter">192.168.22.245   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.22.255    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">192.168.30.128/25   </td><td class="markdownTableBodyCenter">192.168.30.250   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.30.255    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">192.168.40.128/25   </td><td class="markdownTableBodyCenter">192.168.40.250   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">192.168.40.255   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md50"></a>
IPv6</h2>
<p >When creating the IPv6 assignments I ensure the static addresses and DHCP address pool fall outside of SLAAC. I assign a large amount of amount of addresses to DHCP but I exclude 4 Bytes giving 65,536 addresses. I use /127 addresses for point to point links instead of just link-local. It is reproducible when replacing devices, it increases readability and ease of debugging. Unique local FC00::/7 would also work if internet is not required.</p>
<p >2001:db8:0:0000::/56 is subnetted as follows:</p>
<p >2001:db8:0:00ff::/64 is subnetted as follows: </p>
<h3><a class="anchor" id="autotoc_md51"></a>
Native Vlan is 933</h3>
<div class="fragment"><div class="line">R1-ISP: 2001:db8:0:00ff::fffe/127</div>
<div class="line">R2-ISP: 2001:db8:0:00ff::fffc/127</div>
<div class="line">ISP-R1: 2001:db8:0:00ff::ffff/127</div>
<div class="line">ISP-R2: 2001:db8:0:00ff::fffd/127</div>
<div class="line">ISP-R3 2001:db8:0:00ff::fffb/127</div>
<div class="line">R3-ISP 2001:db8:0:00ff::fffa/127</div>
<div class="line">ISP-metal 2001:db8:0:00ff::fff9/127</div>
<div class="line">metal-ISP 2001:db8:0:00ff::fff8/127</div>
<div class="line">ISP-alprouter 2001:db8:0:00ff::fff7/127</div>
<div class="line">alprouter-ISP 2001:db8:0:00ff::fff6/127</div>
<div class="line">R1-SW3 2001:db8:0:00ff::fff5/127</div>
<div class="line">SW3-R1 2001:db8:0:00ff::fff4/127</div>
<div class="line">R2-SW4 2001:db8:0:00ff::fff3/127</div>
<div class="line">SW4-R2 2001:db8:0:00ff::fff2/127</div>
<div class="line">R1-SW4 2001:db8:0:00ff::fff1/127</div>
<div class="line">SW4-R1 2001:db8:0:00ff::fff0/127</div>
<div class="line">R2-SW3 2001:db8:0:00ff::ffef/127</div>
<div class="line">SW3-R2 2001:db8:0:00ff::ffee/127</div>
</div><!-- fragment --><p >2001:db8:0:0000::/60 is subnetted as follows: </p>
<h3><a class="anchor" id="autotoc_md52"></a>
Site 1 - Vlan 10 - sales</h3>
<div class="fragment"><div class="line">2001:db8:0:0001::/64</div>
<div class="line">excluded-address 2001:db8:0:0001:: 2001:db8:0:0001::ffff</div>
<div class="line">excluded-address 2001:db8:0:0001:0200:00ff:fe00:0000 2001:db8:0:0001:fdff:ffff:ffff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0001::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0001::4/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0001::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md53"></a>
Site 1 - Vlan 20 - guest</h3>
<div class="fragment"><div class="line">2001:db8:0:0002::/64</div>
<div class="line">excluded-address 2001:db8:0:0002:: 2001:db8:0:0002::ffff</div>
<div class="line">excluded-address 2001:db8:0:0002:0200:00ff:fe00:0000 2001:db8:0:0002:fdff:ffff:feff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0002::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0002::4/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0002::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md54"></a>
Site 1 - Vlan 30 - management</h3>
<p >2001:db8:0:0003::/64 is subnetted as follows </p><div class="fragment"><div class="line">SW1SVI: 2001:db8:0:0003::11/120</div>
<div class="line">SW2SVI: 2001:db8:0:0003::12/120</div>
<div class="line">SW3SVI: 2001:db8:0:0003::13/120</div>
<div class="line">SW4SVI: 2001:db8:0:0003::14/120</div>
<div class="line">SW5SVI: 2001:db8:0:0003::15/120</div>
<div class="line">SW6SVI: 2001:db8:0:0003::16/120</div>
<div class="line">management_server: 2001:db8:0:0003::a/120</div>
<div class="line">HSRP-gate: 2001:db8:0:0003::1/120</div>
<div class="line">R!: 2001:db8:0:0003::ff1/128</div>
<div class="line">R2: 2001:db8:0:0003::ff2/128</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md55"></a>
Site 1 - Vlan 40 - supervisor</h3>
<div class="fragment"><div class="line">2001:db8:0:0004::/64</div>
<div class="line">excluded-address 2001:db8:0:0004:: 2001:db8:0:0004::ffff</div>
<div class="line">excluded-address 2001:db8:0:0004:0200:00ff:fe00:0000 2001:db8:0:0004:fdff:ffff:feff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0004::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0004::4/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0004::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md56"></a>
Site 1 - Vlan 50 - voice</h3>
<div class="fragment"><div class="line">2001:db8:0:0005::/64</div>
<div class="line">excluded-address 2001:db8:0:0005:: 2001:db8:0:0005::ffff</div>
<div class="line">excluded-address 2001:db8:0:0005:0200:00ff:fe00:0000 2001:db8:0:0005:fdff:ffff:feff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0005::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0005::4/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0005::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md57"></a>
Site 1 - Vlan 60 - guest services</h3>
<div class="fragment"><div class="line">2001:db8:0:0006::/64</div>
<div class="line">excluded-address 2001:db8:0:0006:: 2001:db8:0:0006::ffff</div>
<div class="line">excluded-address 2001:db8:0:0006:0200:00ff:fe00:0000 2001:db8:0:0006:fdff:ffff:feff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0006::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0006::4/64</div>
<div class="line">dns_server: 2001:db8:0:0006::2/64</div>
<div class="line">web_server: 2001:db8:0:0006::5/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0006::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md58"></a>
Site 1 - Vlan 70 - internal services</h3>
<div class="fragment"><div class="line">2001:db8:0:0007::/64</div>
<div class="line">excluded-address 2001:db8:0:0007:: 2001:db8:0:0007::ffff</div>
<div class="line">excluded-address 2001:db8:0:0007:0200:00ff:fe00:0000 2001:db8:0:0007:fdff:ffff:feff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0007::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0007::4/64</div>
<div class="line">aaa_server 2001:db8:0:0007::2/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0007::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md59"></a>
Site 1 - Vlan 80 - accounting</h3>
<div class="fragment"><div class="line">2001:db8:0:0008::/64</div>
<div class="line">excluded-address 2001:db8:0:0008:: 2001:db8:0:0008::ffff</div>
<div class="line">excluded-address 2001:db8:0:0008:0200:00ff:fe00:0000 2001:db8:0:0008:fdff:ffff:feff:ffff</div>
<div class="line">SW3SVI: 2001:db8:0:0008::3/64</div>
<div class="line">SW4SVI: 2001:db8:0:0008::4/64</div>
<div class="line">HSRP-gate: 2001:db8:0:0008::1/64</div>
</div><!-- fragment --><p> 2001:db8:0:0020::/60 is subnetted as follows: </p>
<h3><a class="anchor" id="autotoc_md60"></a>
Site 2 - Vlan 10</h3>
<div class="fragment"><div class="line">2001:db8:0:0021::/64</div>
<div class="line">excluded-address 2001:db8:0:0021:: 2001:db8:0:0021::ffff</div>
<div class="line">excluded-address 2001:db8:0:0021:0200:00ff:fe00:0000 2001:db8:0:0021:fdff:ffff:feff:ffff</div>
<div class="line">Gateway: 2001:db8:0:0021::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md61"></a>
Site 2 - Vlan 20</h3>
<div class="fragment"><div class="line">2001:db8:0:0022::/64</div>
<div class="line">excluded-address 2001:db8:0:0022:: 2001:db8:0:0022::ffff</div>
<div class="line">excluded-address 2001:db8:0:0022:0200:00ff:fe00:0000 2001:db8:0:0022:fdff:ffff:feff:ffff</div>
<div class="line">Gateway: 2001:db8:0:0022::1/64</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md62"></a>
Site 2 - Vlan 30</h3>
<p >2001:db8:0:0023::/64 is subnetted as follows </p><div class="fragment"><div class="line">SW7SVI: 2001:db8:0:0023::17/120</div>
<div class="line">Gateway: 2001:db8:0:0023::1/120</div>
<div class="line">R3: 2001:db8:0:0023::ff3/128</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md63"></a>
Site 2 - Vlan 40</h3>
<div class="fragment"><div class="line">2001:db8:0:0024::/64</div>
<div class="line">excluded-address 2001:db8:0:0024:: 2001:db8:0:0024::ffff</div>
<div class="line">excluded-address 2001:db8:0:0024:0200:00ff:fe00:0000 2001:db8:0:0024:fdff:ffff:feff:ffff</div>
<div class="line">Gateway: 2001:db8:0:0024::1/64</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md64"></a>
ISP Simulation</h2>
<p >For internet access I exit the lab via the alpouter node. This performs nat66. For host machine access I exit the lab via the Metal node. </p><div class="fragment"><div class="line">en</div>
<div class="line">conf t</div>
<div class="line">host ISP</div>
<div class="line"> </div>
<div class="line">access-list 1 permit 10.10.10.10</div>
<div class="line">access-list 1 deny   any</div>
<div class="line">access-list 2 permit 10.10.10.20</div>
<div class="line">access-list 2 deny   any</div>
<div class="line">access-list 3 permit 10.10.10.30</div>
<div class="line">access-list 3 deny   any</div>
<div class="line"> </div>
<div class="line">ip routing</div>
<div class="line">ipv un</div>
<div class="line"> </div>
<div class="line">!ISP-R1 </div>
<div class="line">interface e0/0</div>
<div class="line">no switchp</div>
<div class="line">ip access-group 1 in</div>
<div class="line">ip add 10.10.10.11 255.255.255.254</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::ffff/127</div>
<div class="line">no shutdown</div>
<div class="line"> </div>
<div class="line">!ISP-R2</div>
<div class="line">interface e0/1</div>
<div class="line">no switchp</div>
<div class="line">ip access-group 2 in</div>
<div class="line">ip add 10.10.10.21 255.255.255.254</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fffd/127</div>
<div class="line">no shutdown</div>
<div class="line"> </div>
<div class="line">!ISP-R3 2001:db8:0:00ff::fffb/127</div>
<div class="line">interface e0/2</div>
<div class="line">no switchp</div>
<div class="line">ip access-group 3 in</div>
<div class="line">ip add 10.10.10.31 255.255.255.254</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fffb/127</div>
<div class="line">no shutdown</div>
<div class="line"> </div>
<div class="line">!ISP-metal 2001:db8:0:00ff::fff9/127</div>
<div class="line">interface e0/3</div>
<div class="line">no switchp</div>
<div class="line">ip address 192.168.1.245 255.255.255.0</div>
<div class="line">ipv6 enable</div>
<div class="line">no shutdown</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fff9/127</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">! ISP-alprouter 2001:db8:0:00ff::fff7/127</div>
<div class="line">interface e1/0</div>
<div class="line">no switchp</div>
<div class="line">ipv6 enable</div>
<div class="line">no shutdown</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fff7/127</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip route 0.0.0.0 0.0.0.0 192.168.1.1</div>
<div class="line">ipv6 route 0::/0 e1/0 2001:db8:0:00ff::fff6</div>
<div class="line">ipv6 route 2001:db8:0:0000::/60 e0/0 2001:db8:0:00ff::fffe</div>
<div class="line">ipv6 route 2001:db8:0:0000::/60 e0/1 2001:db8:0:00ff::fffa 5</div>
<div class="line">ipv6 route 2001:db8:0:0020::/60 e0/2 2001:db8:0:00ff::fffc</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md65"></a>
Topology Diagram (Draft)</h2>
<p >It is not good quality. I will look at creating a proper diagram in the future. <img src="topology1.png" alt="This is an example image" width="90%" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md66"></a>
Ether-channel</h1>
<p >There are three ether-channels in the topology. SW6 connecting to the two distribution layer switches is layer 2. I initially planned the two distribution switches interconnecting as layer 3, but I realised that could cause extra traffic. If the root bridge SVI and HSRP master did not match it would cause layer 2 traffic to switch avoiding port-channel 2. Really this would only occur due to misconfiguration or hardware failures outside of preemption windows for HSRP. Regardless I configured it as a layer 2 link.</p>
<p >I configure SW6-SW3 as LACP. Active &amp; passive are the LACP keywords. active-active is a little slower to negotiate than active-passive. </p>
<h3><a class="anchor" id="autotoc_md67"></a>
SW6 Config</h3>
<div class="fragment"><div class="line">interface r e0/1, e1/2</div>
<div class="line">channel-group 1 mode active</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md68"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">interface r e1/0, e1/1</div>
<div class="line">channel-group 1 mode active</div>
</div><!-- fragment --><p >I configure SW6-SW4 as PAGP </p>
<h3><a class="anchor" id="autotoc_md69"></a>
SW6 Config</h3>
<div class="fragment"><div class="line">interface r e1/1,e0/0</div>
<div class="line">channel-group 2 mode desirable</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md70"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface r e2/0,e0/3</div>
<div class="line">channel-group 1 mode desirable</div>
</div><!-- fragment --><p >I configure SW3-SW4 as LACP </p>
<h3><a class="anchor" id="autotoc_md71"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">interface r e0/0-2</div>
<div class="line">channel-group 2 mode active</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md72"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface r e0/0-2</div>
<div class="line">channel-group 2 mode active</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md73"></a>
Testing</h3>
<p >I view my ether-channels with show ether-channel summary. They all report as layer 2 since I haven't used <b>no switchport</b> on the port-channels. </p>
<h1><a class="anchor" id="autotoc_md74"></a>
VLANs</h1>
<p >VLANs are outlined in the Topology Data section. I will not be using VTP in my configuration. Trunk encapsulation is dot1q in modern networks. R3 needs to act as a router on a stick. The sub-interfaces act as default gateways much like SVI's. They will be assigned layer 3 addresses in a different section.</p>
<h3><a class="anchor" id="autotoc_md75"></a>
Switch 1-7 Config</h3>
<div class="fragment"><div class="line">vlan 10</div>
<div class="line">name sales</div>
<div class="line">vlan 20</div>
<div class="line">name guest</div>
<div class="line">vlan 30</div>
<div class="line">name management</div>
<div class="line">vlan 40</div>
<div class="line">name supervisor</div>
<div class="line">vlan 50</div>
<div class="line">name voice</div>
<div class="line">vlan 60</div>
<div class="line">name guest-services</div>
<div class="line">vlan 70</div>
<div class="line">name internal-services</div>
<div class="line">vlan 80</div>
<div class="line">name accounting</div>
<div class="line">vlan 933</div>
<div class="line">name native</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md76"></a>
SW1 Config</h3>
<div class="fragment"><div class="line">interface r e0/1,e0/0,e1/1,e1/2,e1/3</div>
<div class="line">switchport access vlan 10</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e2/0,e2/1,e2/2,e2/3</div>
<div class="line">switchport access vlan 20</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e0/3,e1/0,e0/2</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,50</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md77"></a>
SW2 Config</h3>
<div class="fragment"><div class="line">interface r e1/2,e0/1,e1/0</div>
<div class="line">switchport access vlan 10</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e1/3,e2/0,e2/1,e2/3</div>
<div class="line">switchport access vlan 20</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface e1/1</div>
<div class="line">switchport access vlan 40</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface e2/2</div>
<div class="line">switchport access vlan 80</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e0/3,e0/0,e0/2</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,50</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
<div class="line">exit</div>
</div><!-- fragment --><p >The two distribution layer switches will need SVI's at layer 3. They will act as the layer 3 gateways. Layer 3 configuration is in a different section. </p>
<h3><a class="anchor" id="autotoc_md78"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">interface e0/3</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40</div>
<div class="line">interface e2/0</div>
<div class="line">switchport trunk allowed vlan 10,20,30</div>
<div class="line">interface e3/0</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,80</div>
<div class="line">interface port 1</div>
<div class="line">switchport trunk allowed vlan 30,60,70</div>
<div class="line">interface port 2</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,50,60,70,80</div>
<div class="line">interface r e0/3,e2/0,e3/0,port 1, port 2</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md79"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface e1/2</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40</div>
<div class="line">interface e1/1</div>
<div class="line">switchport trunk allowed vlan 10,20,30</div>
<div class="line">interface e1/0</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,80</div>
<div class="line">interface port 1</div>
<div class="line">switchport trunk allowed vlan 30,60,70</div>
<div class="line">interface port 2</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,50,60,70,80</div>
<div class="line">interface r e1/2,e1/1,e1/0,port 1, port 2</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md80"></a>
SW5 Config</h3>
<div class="fragment"><div class="line">interface r e0/3,e0/2</div>
<div class="line">switchport access vlan 10</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e1/1,e1/2,e1/3,e2/0</div>
<div class="line">switchport access vlan 20</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface e1/0</div>
<div class="line">switchport access vlan 40</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e0/0,e0/1</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40,50</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md81"></a>
SW6 Config</h3>
<div class="fragment"><div class="line">interface e0/2</div>
<div class="line">switchport access vlan 30</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e1/0,e1/3</div>
<div class="line">switchport access vlan 60</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface e0/3</div>
<div class="line">switchport access vlan 70</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r port 1,port 2</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk allowed vlan 30,60,70</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md82"></a>
SW7 Config</h3>
<div class="fragment"><div class="line">interface r e0/1,e0/2,e0/3</div>
<div class="line">switchport access vlan 10</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface r e1/1,e1/2,e1/3,e2/0,e2/1</div>
<div class="line">switchport access vlan 20</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface e1/0</div>
<div class="line">switchport access vlan 40</div>
<div class="line">switchport mode access</div>
<div class="line">switchport nonegotiate</div>
<div class="line">interface e0/0</div>
<div class="line">switchport trunk encapsulation dot1q</div>
<div class="line">switchport trunk allowed vlan 10,20,30,40</div>
<div class="line">switchport trunk native vlan 933</div>
<div class="line">switchport mode trunk</div>
<div class="line">switchport nonegotiate</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md83"></a>
R3 Config</h3>
<div class="fragment"><div class="line">interface e0/1</div>
<div class="line">no shutdown</div>
<div class="line">interface e0/1.10</div>
<div class="line">encapsulation dot1Q 10</div>
<div class="line">interface e0/1.20</div>
<div class="line">encapsulation dot1Q 20</div>
<div class="line">interface e0/1.30</div>
<div class="line">encapsulation dot1Q 30</div>
<div class="line">interface e0/1.40</div>
<div class="line">encapsulation dot1Q 40</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md84"></a>
Testing</h3>
<p ><b>show vlan brief</b> displays the vlan assignments. <b>Show interface trunk</b> is another good command for confirming the trunk config. </p>
<h1><a class="anchor" id="autotoc_md85"></a>
STP</h1>
<p >For STP I want different ports blocking per VLAN to help reduce unnecessary congestion. I configure Rapid PVST+. I configure SW3 as root for sales and supervisor. I configure SW4 as root for guest and the others.</p>
<h3><a class="anchor" id="autotoc_md86"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">spanning-tree mode rapid-pvst</div>
<div class="line">spanning-tree vlan 10 priority 0</div>
<div class="line">spanning-tree vlan 20 priority 4096</div>
<div class="line">spanning-tree vlan 30 priority 4096</div>
<div class="line">spanning-tree vlan 40 priority 0</div>
<div class="line">spanning-tree vlan 50 priority 4096</div>
<div class="line">spanning-tree vlan 60 priority 4096</div>
<div class="line">spanning-tree vlan 70 priority 4096</div>
<div class="line">spanning-tree vlan 80 priority 4096</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md87"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">spanning-tree mode rapid-pvst</div>
<div class="line">spanning-tree vlan 10 priority 4096</div>
<div class="line">spanning-tree vlan 20 priority 0</div>
<div class="line">spanning-tree vlan 30 priority 0</div>
<div class="line">spanning-tree vlan 40 priority 4096</div>
<div class="line">spanning-tree vlan 50 priority 0</div>
<div class="line">spanning-tree vlan 60 priority 0</div>
<div class="line">spanning-tree vlan 70 priority 0</div>
<div class="line">spanning-tree vlan 80 priority 0</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md88"></a>
SW1,SW2,SW5,SW6 Config</h3>
<div class="fragment"><div class="line">spanning-tree mode rapid-pvst</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md89"></a>
Testing</h3>
<p >I can clearly see the root bridge status and the port roles in this excerpt for each vlan. The switch is correctly root in certain vlans and not others. I can also see the port channel is lower cost. </p><div class="fragment"><div class="line">VLAN0010</div>
<div class="line">  Spanning tree enabled protocol rstp</div>
<div class="line">  Root ID    Priority    10</div>
<div class="line">             Address     aabb.cc00.0600</div>
<div class="line">             This bridge is the root</div>
<div class="line">             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec</div>
<div class="line"> </div>
<div class="line">  Bridge ID  Priority    10     (priority 0 sys-id-ext 10)</div>
<div class="line">             Address     aabb.cc00.0600</div>
<div class="line">             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec</div>
<div class="line">             Aging Time  300 sec</div>
<div class="line"> </div>
<div class="line">Interface           Role Sts Cost      Prio.Nbr Type</div>
<div class="line">------------------- ---- --- --------- -------- --------------------------------</div>
<div class="line">Et0/3               Desg FWD 100       128.4    P2p </div>
<div class="line">Et2/0               Desg FWD 100       128.9    P2p </div>
<div class="line">Et3/0               Desg FWD 100       128.13   P2p </div>
<div class="line">Po2                 Desg FWD 47        128.66   P2p </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          </div>
<div class="line">VLAN0020information</div>
<div class="line">  Spanning tree enabled protocol rstp</div>
<div class="line">  Root ID    Priority    20</div>
<div class="line">             Address     aabb.cc00.0700</div>
<div class="line">             Cost        47</div>
<div class="line">             Port        66 (Port-channel2)</div>
<div class="line">             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec</div>
<div class="line"> </div>
<div class="line">  Bridge ID  Priority    4116   (priority 4096 sys-id-ext 20)</div>
<div class="line">             Address     aabb.cc00.0600</div>
<div class="line">             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec</div>
<div class="line">             Aging Time  300 sec</div>
<div class="line"> </div>
<div class="line">Interface           Role Sts Cost      Prio.Nbr Type</div>
<div class="line">------------------- ---- --- --------- -------- --------------------------------</div>
<div class="line">Et0/3               Desg FWD 100       128.4    P2p </div>
<div class="line">Et2/0               Desg FWD 100       128.9    P2p </div>
<div class="line">Et3/0               Desg FWD 100       128.13   P2p </div>
<div class="line">Po2                 Root FWD 47        128.66   P2p</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md90"></a>
IPv4</h1>
<p >I configure gateway addresses for R3 sub-interfaces. This is where all the outreach site traffic will be routed between VLANs. I create vlan SVI's on SW3 &amp; SW4. This is where the main site traffic will be routed between VLAN's. HSRP will provide a redundant gateway address between the distribution switch SVI's. I am using /31 for subnets with two devices. This should be supported by all the network devices.</p>
<h3><a class="anchor" id="autotoc_md91"></a>
R1 Config</h3>
<div class="fragment"><div class="line">interface g1</div>
<div class="line">ip add 192.168.2.64 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface g2</div>
<div class="line">ip add 10.10.10.10 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface g3</div>
<div class="line">ip add 192.168.2.72 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface lo0</div>
<div class="line">ip add 192.168.2.1 255.255.255.255</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md92"></a>
R2 Config</h3>
<div class="fragment"><div class="line">interface e0/0</div>
<div class="line">ip add 192.168.2.66 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface e0/1</div>
<div class="line">ip add 10.10.10.20 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface e0/2</div>
<div class="line">ip add 192.168.2.74 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface lo0</div>
<div class="line">ip add 192.168.2.2 255.255.255.255</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md93"></a>
R3 Config</h3>
<div class="fragment"><div class="line">interface e0/1</div>
<div class="line">no shutdown</div>
<div class="line">interface e0/1.10</div>
<div class="line">ip add 192.168.10.254 255.255.255.128</div>
<div class="line">interface e0/1.20</div>
<div class="line">ip add 192.168.22.254 255.255.255.0</div>
<div class="line">interface e0/1.30</div>
<div class="line">ip add 192.168.30.254 255.255.255.128</div>
<div class="line">interface e0/1.40</div>
<div class="line">ip add 192.168.40.254 255.255.255.128</div>
<div class="line">interface lo0</div>
<div class="line">ip add 192.168.2.3 255.255.255.255</div>
<div class="line">no shutdown</div>
<div class="line">interface e0/0</div>
<div class="line">ip add 10.10.10.30 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md94"></a>
SW1 Config</h3>
<div class="fragment"><div class="line">ip default-gateway 192.168.30.127</div>
<div class="line">interface vlan 30 </div>
<div class="line">ip add 192.168.30.1 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md95"></a>
SW2 Config</h3>
<div class="fragment"><div class="line">ip default-gateway 192.168.30.127</div>
<div class="line">interface vlan 30</div>
<div class="line">ip add 192.168.30.2 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md96"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">interface vlan 10</div>
<div class="line">ip add 192.168.10.124 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 20</div>
<div class="line">ip add 192.168.21.252 255.255.254.0</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 30</div>
<div class="line">ip add 192.168.30.3 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 40</div>
<div class="line">ip add 192.168.40.124 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 60</div>
<div class="line">ip add 192.168.60.252 255.255.255.0</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 70</div>
<div class="line">ip add 192.168.70.252 255.255.255.0</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 80</div>
<div class="line">ip add 192.168.80.252 255.255.255.0</div>
<div class="line">no shutdown</div>
<div class="line">interface e4/0</div>
<div class="line">no switchp</div>
<div class="line">ip add 192.168.2.65 255.255.255.254</div>
<div class="line">interface e1/2</div>
<div class="line">no switchp</div>
<div class="line">ip add 192.168.2.75 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface lo0</div>
<div class="line">ip add 192.168.2.13 255.255.255.255</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md97"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface vlan 10</div>
<div class="line">ip add 192.168.10.125 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 20</div>
<div class="line">ip add 192.168.21.253 255.255.254.0</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 30</div>
<div class="line">ip add 192.168.30.4 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 40</div>
<div class="line">ip add 192.168.40.125 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 60</div>
<div class="line">ip add 192.168.60.253 255.255.255.0</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 70</div>
<div class="line">ip add 192.168.70.253 255.255.255.0</div>
<div class="line">no shutdown</div>
<div class="line">interface vlan 80</div>
<div class="line">ip add 192.168.80.253 255.255.255.0</div>
<div class="line">interface e1/3</div>
<div class="line">no switchp</div>
<div class="line">ip add 192.168.2.67 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface e2/1</div>
<div class="line">no switchp</div>
<div class="line">ip add 192.168.2.73 255.255.255.254</div>
<div class="line">no shutdown</div>
<div class="line">interface lo0</div>
<div class="line">ip add 192.168.2.14 255.255.255.255</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md98"></a>
SW5 Config</h3>
<div class="fragment"><div class="line">ip default-gateway 192.168.30.127</div>
<div class="line">interface vlan 30 </div>
<div class="line">ip add 192.168.30.5 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md99"></a>
SW6 Config</h3>
<div class="fragment"><div class="line">ip default-gateway 192.168.30.127</div>
<div class="line">interface vlan 30 </div>
<div class="line">ip add 192.168.30.6 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md100"></a>
SW7 Config</h3>
<div class="fragment"><div class="line">ip default-gateway 192.168.30.254</div>
<div class="line">interface vlan 30 </div>
<div class="line">ip add 192.168.30.137 255.255.255.128</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md101"></a>
Testing</h3>
<p >I can check this config using <b>show ip int brief</b> on device.</p>
<h1><a class="anchor" id="autotoc_md102"></a>
First Hop Redundancy - HSRP</h1>
<p >I configure HSRP for first hop redundancy. Without HSRP, losing a distribution switch would knock out the single gateway that must be assigned on hosts. With HSRP either switch can act as the gateway for traffic between subnets. For HSRP the priority will match the STP root bridges. SW3 interface vlan 10 &amp; interface vlan 40 will be priority. SW4 will be priority for all the other vlan SVI HSRP processes. The id will match the vlan id. The switches have a delay before they try to preempt their master state of 60secs. This is to mitigate excessive outages due to flapping. The timers are set much lower than default resulting in faster convergence at the cost of bandwidth and stability. The 650 hold time with 200 hello means that the switch would likely have to miss 3 consecutive hello frames before taking over.</p>
<h3><a class="anchor" id="autotoc_md103"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">interface vlan 10</div>
<div class="line">standby ip 192.168.10.126</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 20</div>
<div class="line">standby ip 192.168.21.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 30</div>
<div class="line">standby ip 192.168.30.126</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 40</div>
<div class="line">standby ip 192.168.40.126</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 60</div>
<div class="line">standby ip 192.168.60.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 70</div>
<div class="line">standby ip 192.168.70.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 80</div>
<div class="line">standby ip 192.168.80.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md104"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface vlan 10</div>
<div class="line">standby ip 192.168.10.126</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 20</div>
<div class="line">standby ip 192.168.21.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 30</div>
<div class="line">standby ip 192.168.30.126</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 40</div>
<div class="line">standby ip 192.168.40.126</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 111</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 60</div>
<div class="line">standby ip 192.168.60.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 70</div>
<div class="line">standby ip 192.168.70.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">interface vlan 80</div>
<div class="line">standby ip 192.168.80.254</div>
<div class="line">standby preempt delay rel 60</div>
<div class="line">standby priority 200</div>
<div class="line">standby 0 timers msec 200 msec 650</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md105"></a>
Testing</h3>
<p >Using <b>show standby</b> I can get the info I need to verify HSRP is operating as intended.</p>
<p >Example SW3 excerpt: </p><div class="fragment"><div class="line">Preemption enabled, delay reload 60 secs</div>
<div class="line">  Active router is local</div>
<div class="line">  Standby router is 192.168.10.125, priority 111 (expires in 0.688 sec)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md106"></a>
OSPF</h1>
<p >I enable OSPF on the layer 3 devices. I disable OSPF advertisements on the WAN interfaces. In a later section I intend to use OSPF over vpn connections to the outreach site. I set the SVI's as passive besides Vlan 30 management. Both R1 and R2 are advertising the default route but the route cost will depend on who is the HSRP gateway for VLAN 30. I set the reference cost to 100k to avoid gigabit links having the same bandwidth as 100 megabit links. All of the network is single area. The ISP doesn't participate in OSPF. Default gateways direct traffic that doesn't belong in the LAN on either site to the ISP. </p>
<h3><a class="anchor" id="autotoc_md107"></a>
R1 Config</h3>
<div class="fragment"><div class="line">ip route 0.0.0.0 0.0.0.0 10.10.10.11</div>
<div class="line">router ospf 1</div>
<div class="line">auto-cost reference-bandwidth 100000</div>
<div class="line">default-information originate</div>
<div class="line">passive-interface e0/1</div>
<div class="line"> </div>
<div class="line">network 10.10.10.10 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.1 0.0.0.0 a 0</div>
<div class="line">network 192.168.2.64 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.72 0.0.0.1 a 0</div>
<div class="line"> </div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md108"></a>
R2 Config</h3>
<div class="fragment"><div class="line">ip route 0.0.0.0 0.0.0.0 10.10.10.21</div>
<div class="line">router ospf 1</div>
<div class="line">auto-cost reference-bandwidth 100000</div>
<div class="line">default-information originate</div>
<div class="line">passive-interface e0/1</div>
<div class="line"> </div>
<div class="line">network 10.10.10.20 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.2 0.0.0.0 a 0</div>
<div class="line">network 192.168.2.66 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.74 0.0.0.1 a 0</div>
<div class="line"> </div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md109"></a>
R3 Config</h3>
<div class="fragment"><div class="line">ip route 0.0.0.0 0.0.0.0 10.10.10.31</div>
<div class="line">router ospf 1</div>
<div class="line">auto-cost reference-bandwidth 100000</div>
<div class="line">default-information originate</div>
<div class="line"> </div>
<div class="line">passive-interface e0/1</div>
<div class="line">passive-interface e0/1.10</div>
<div class="line">passive-interface e0/1.20</div>
<div class="line">passive-interface e0/1.30</div>
<div class="line">passive-interface e0/1.40</div>
<div class="line"> </div>
<div class="line">network 10.10.10.30 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.3 0.0.0.0 a 0</div>
<div class="line">network 192.168.10.128 0.0.0.127 a 0</div>
<div class="line">network 192.168.22.0 0.0.0.255 a 0</div>
<div class="line">network 192.168.30.128 0.0.0.127 a 0</div>
<div class="line">network 192.168.40.128 0.0.0.127 a 0</div>
<div class="line"> </div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md110"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">ip routing</div>
<div class="line">router ospf 1</div>
<div class="line">auto-cost reference-bandwidth 100000</div>
<div class="line"> </div>
<div class="line">network 192.168.2.64 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.74 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.13 0.0.0.0 a 0</div>
<div class="line">network 192.168.10.0 0.0.0.127 area 0</div>
<div class="line">network 192.168.20.0 0.0.1.255 area 0</div>
<div class="line">network 192.168.30.0 0.0.0.127 area 0</div>
<div class="line">network 192.168.40.0 0.0.0.127 area 0</div>
<div class="line">network 192.168.60.0 0.0.0.255 area 0</div>
<div class="line">network 192.168.70.0 0.0.0.255 area 0</div>
<div class="line">network 192.168.80.0 0.0.0.255 area 0</div>
<div class="line"> </div>
<div class="line">passive-interface Vlan10</div>
<div class="line">passive-interface Vlan20</div>
<div class="line">passive-interface Vlan40</div>
<div class="line">passive-interface Vlan60</div>
<div class="line">passive-interface Vlan70</div>
<div class="line">passive-interface Vlan80</div>
<div class="line"> </div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md111"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">ip routing</div>
<div class="line">router ospf 1</div>
<div class="line">auto-cost reference-bandwidth 100000</div>
<div class="line"> </div>
<div class="line">network 192.168.2.66 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.72 0.0.0.1 a 0</div>
<div class="line">network 192.168.2.14 0.0.0.0 a 0</div>
<div class="line">network 192.168.10.0 0.0.0.127 area 0</div>
<div class="line">network 192.168.20.0 0.0.1.255 area 0</div>
<div class="line">network 192.168.30.0 0.0.0.127 area 0</div>
<div class="line">network 192.168.40.0 0.0.0.127 area 0</div>
<div class="line">network 192.168.60.0 0.0.0.255 area 0</div>
<div class="line">network 192.168.70.0 0.0.0.255 area 0</div>
<div class="line">network 192.168.80.0 0.0.0.255 area 0</div>
<div class="line"> </div>
<div class="line">passive-interface Vlan10</div>
<div class="line">passive-interface Vlan20</div>
<div class="line">passive-interface Vlan40</div>
<div class="line">passive-interface Vlan60</div>
<div class="line">passive-interface Vlan70</div>
<div class="line">passive-interface Vlan80</div>
<div class="line"> </div>
<div class="line">exit</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md112"></a>
Cisco DHCP (Non-Redundant)</h1>
<p >I have decided to use SW3(main) and R3(outreach) as the DHCP servers. Note the SW3 selection creates a single point of failure and may stress the hardware. This is the logical choice out of CCNA level topics I believe. A backup should be considered in the future.</p>
<p >SW4 SVI will be configured with a helper address so SW4 forwards DHCP traffic to the server on SW3. If SW3 goes down then clients in the main site will be unable to use DHCP.</p>
<p >As specified in topology data section each vlan has an excluded address range for static IP assignment. </p>
<h3><a class="anchor" id="autotoc_md113"></a>
R3 Config</h3>
<div class="fragment"><div class="line">ip dhcp excluded-address 192.168.10.250 192.168.10.255</div>
<div class="line">ip dhcp excluded-address 192.168.22.245 192.168.22.255</div>
<div class="line">ip dhcp excluded-address 192.168.30.250 192.168.30.255</div>
<div class="line">ip dhcp excluded-address 192.168.40.250 192.168.40.255</div>
<div class="line">ip dhcp pool 10</div>
<div class="line">network 192.168.10.128 /25</div>
<div class="line">default-router 192.168.10.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">ip dhcp pool 22</div>
<div class="line">network 192.168.22.0 /24</div>
<div class="line">default-router 192.168.22.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">ip dhcp pool 30</div>
<div class="line">network 192.168.30.128 /25</div>
<div class="line">default-router 192.168.30.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">ip dhcp pool 40</div>
<div class="line">network 192.168.40.128 /25</div>
<div class="line">default-router 192.168.40.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md114"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">ip dhcp excluded-address 192.168.10.120 192.168.10.127</div>
<div class="line">ip dhcp excluded-address 192.168.21.245 192.168.21.255</div>
<div class="line">ip dhcp excluded-address 192.168.30.120 192.168.30.127</div>
<div class="line">ip dhcp excluded-address 192.168.40.120 192.168.40.127</div>
<div class="line">ip dhcp excluded-address 192.168.60.225 192.168.60.255</div>
<div class="line">ip dhcp excluded-address 192.168.70.225 192.168.70.255</div>
<div class="line">ip dhcp excluded-address 192.168.80.225 192.168.80.255</div>
<div class="line">ip dhcp pool 10</div>
<div class="line">network  192.168.10.0 /25</div>
<div class="line">default-router 192.168.10.126</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
<div class="line">ip dhcp pool 20</div>
<div class="line">network 192.168.20.0 /23</div>
<div class="line">default-router 192.168.21.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
<div class="line">ip dhcp pool 30</div>
<div class="line">network 192.168.30.0 /25</div>
<div class="line">default-router 192.168.30.126</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
<div class="line">ip dhcp pool 40</div>
<div class="line">network 192.168.40.0 /25</div>
<div class="line">default-router 192.168.40.126</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
<div class="line">ip dhcp pool 60</div>
<div class="line">network 192.168.60.0 /24</div>
<div class="line">default-router 192.168.60.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
<div class="line">ip dhcp pool 70</div>
<div class="line">network 192.168.70.0 /24</div>
<div class="line">default-router 192.168.70.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
<div class="line">ip dhcp pool 80</div>
<div class="line">network 192.168.80.0 /24</div>
<div class="line">default-router 192.168.80.254</div>
<div class="line">domain-name TapeItUp</div>
<div class="line">dns-server 192.168.60.250 1.1.1.1</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md115"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface r vl 10-80</div>
<div class="line">ip helper-address 192.168.2.13</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md116"></a>
NAT + WAN ACL</h1>
<p >I configure dynamic NAT. I configure port address translation. I configure an access list to permit any host on the LAN to be translated.</p>
<p >Initially I left NAT as "permit any". However after debugging the VPN I discovered that it will not work if the NAT ACL includes ANY summarisation of the crypto map list matching traffic. My assumption was that the more specific ACL entry would take precedence, but that is clearly false.</p>
<h3><a class="anchor" id="autotoc_md117"></a>
R1 Config</h3>
<div class="fragment"><div class="line">ip access-list extended NAT</div>
<div class="line">deny ip 192.168.0.0 0.0.255.255 any</div>
<div class="line">permit ip any any</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip nat inside source list NAT interface g2 overload</div>
<div class="line"> </div>
<div class="line">ip access-list extended WAN_FILTER</div>
<div class="line">10 deny ip 224.0.0.0 15.255.255.255 any</div>
<div class="line">20 deny ip any 224.0.0.0 15.255.255.255</div>
<div class="line">10000 permit ip host 10.10.10.10 any</div>
<div class="line">100000 deny ip any any log</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface r g1,g3</div>
<div class="line">ip nat inside</div>
<div class="line">interface g2</div>
<div class="line">ip nat outside</div>
<div class="line">ip access-group WAN_FILTER out</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md118"></a>
R2 Config</h3>
<div class="fragment"><div class="line">ip access-list extended NAT</div>
<div class="line">deny ip 192.168.0.0 0.0.255.255 any</div>
<div class="line">permit ip any any</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip nat inside source list NAT interface ethernet 0/1 overload</div>
<div class="line"> </div>
<div class="line">ip access-list extended WAN_FILTER</div>
<div class="line">10 deny ip 224.0.0.0 15.255.255.255 any</div>
<div class="line">20 deny ip any 224.0.0.0 15.255.255.255</div>
<div class="line">10000 permit ip host 10.10.10.10 any</div>
<div class="line">100000 deny ip any any log</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface e0/0</div>
<div class="line">ip nat inside</div>
<div class="line">interface Ethernet0/1</div>
<div class="line">ip nat outside</div>
<div class="line">ip access-group WAN_FILTER out</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md119"></a>
R3 Config</h3>
<div class="fragment"><div class="line">ip access-list extended NAT</div>
<div class="line">deny ip 192.168.0.0 0.0.255.255 any</div>
<div class="line">permit ip any any</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip nat inside source list NAT interface ethernet 0/0 overload</div>
<div class="line"> </div>
<div class="line">ip access-list extended WAN_FILTER</div>
<div class="line">10 deny ip 224.0.0.0 15.255.255.255 any</div>
<div class="line">20 deny ip any 224.0.0.0 15.255.255.255</div>
<div class="line">10000 permit ip host 10.10.10.10 any</div>
<div class="line">100000 deny ip any any log</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface e0/1</div>
<div class="line">ip nat inside</div>
<div class="line">interface Ethernet0/0</div>
<div class="line">ip nat outside</div>
<div class="line">ip access-group WAN_FILTER out</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md120"></a>
Test</h3>
<p >I test by pinging 192.168.1.1 from guest0</p>
<div class="fragment"><div class="line">VPCS&gt; ip dhcp</div>
<div class="line">DDORA IP 192.168.10.1/25 GW 192.168.10.126</div>
<div class="line"> </div>
<div class="line">VPCS&gt; ping 10.10.10.11</div>
<div class="line"> </div>
<div class="line">84 bytes from 10.10.10.11 icmp_seq=1 ttl=253 time=1.187 ms</div>
</div><!-- fragment --><p >I can view the translations with <b>show ip nat translations</b>. This is an excerpt: </p><div class="fragment"><div class="line">Pro Inside global      Inside local       Outside local      Outside global</div>
<div class="line">icmp 10.10.10.10:16507 192.168.10.1:16507 10.10.10.11:16507  10.10.10.11:16507</div>
<div class="line">icmp 10.10.10.10:16763 192.168.10.1:16763 10.10.10.11:16763  10.10.10.11:16763</div>
<div class="line">icmp 10.10.10.10:17019 192.168.10.1:17019 10.10.10.11:17019  10.10.10.11:17019</div>
<div class="line">icmp 10.10.10.10:17275 192.168.10.1:17275 10.10.10.11:17275  10.10.10.11:17275</div>
<div class="line">icmp 10.10.10.10:17531 192.168.10.1:17531 10.10.10.11:17531  10.10.10.11:17531</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md121"></a>
VPN - IPSec - PSK</h1>
<p >IPSec is a secure VPN technology. It doesn't support multicast unless I combine with GRE. Multicast is not essential for OSPF as I can manually specify the neighbour. I made sure to use the interface Tunnel0 as it simplifies the config. It is essential to have the same policy at either end. Advertising the endpoints WAN port over the VPN using OSPF will cause flapping or errors. I use static routes to ensure the WAN ports preferred route remains outside VPN. The WAN port over VPN routes are still available in the OSPF process, but I see no reason they would be used instead of a static route with default ad. </p>
<h3><a class="anchor" id="autotoc_md122"></a>
R1 Config</h3>
<div class="fragment"><div class="line">crypto isakmp policy 10</div>
<div class="line">en aes 256</div>
<div class="line">auth pre-share</div>
<div class="line">group 14</div>
<div class="line">lifetime 3600</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">crypto isakmp key vpnsecretkey13 address 10.10.10.30</div>
<div class="line"> </div>
<div class="line">crypto ipsec transform-set ESP-AES256-SHA esp-aes 256 esp-sha-hmac </div>
<div class="line">mode tunnel</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip access-list extended vpn_traff</div>
<div class="line">permit ip 192.168.0.0 0.0.255.255 192.168.0.0 0.0.255.255</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">crypto ipsec profile VPNPROFILE</div>
<div class="line">set transform-set ESP-AES256-SHA</div>
<div class="line"> </div>
<div class="line">interface Tunnel0</div>
<div class="line">ip address 192.168.2.68 255.255.255.254</div>
<div class="line">tunnel source g2</div>
<div class="line">tunnel mode ipsec ipv4</div>
<div class="line">tunnel destination 10.10.10.30</div>
<div class="line">tunnel protection ipsec profile VPNPROFILE</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip route 10.10.10.20 255.255.255.255 10.10.10.11</div>
<div class="line">ip route 10.10.10.30 255.255.255.255 10.10.10.11</div>
<div class="line"> </div>
<div class="line">router ospf 1</div>
<div class="line">neighbor 192.168.2.3</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md123"></a>
R2 Config</h3>
<div class="fragment"><div class="line">crypto isakmp policy 10</div>
<div class="line">en aes 256</div>
<div class="line">auth pre-share</div>
<div class="line">group 14</div>
<div class="line">lifetime 3600</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">crypto isakmp key vpnsecretkey23 address 10.10.10.30</div>
<div class="line"> </div>
<div class="line">crypto ipsec transform-set ESP-AES256-SHA esp-aes 256 esp-sha-hmac </div>
<div class="line">mode tunnel</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip access-list extended vpn_traff</div>
<div class="line">permit ip 192.168.0.0 0.0.255.255 192.168.0.0 0.0.255.255</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">crypto ipsec profile VPNPROFILE</div>
<div class="line">set transform-set ESP-AES256-SHA</div>
<div class="line"> </div>
<div class="line">interface Tunnel0</div>
<div class="line">ip address 192.168.2.70 255.255.255.254</div>
<div class="line">tunnel source Ethernet0/1</div>
<div class="line">tunnel mode ipsec ipv4</div>
<div class="line">tunnel destination 10.10.10.30</div>
<div class="line">tunnel protection ipsec profile VPNPROFILE</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip route 10.10.10.10 255.255.255.255 10.10.10.21</div>
<div class="line">ip route 10.10.10.30 255.255.255.255 10.10.10.21</div>
<div class="line"> </div>
<div class="line">router ospf 1</div>
<div class="line">neighbor 192.168.2.3</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md124"></a>
R3 Config</h3>
<div class="fragment"><div class="line">crypto isakmp policy 10</div>
<div class="line">en aes 256</div>
<div class="line">auth pre-share</div>
<div class="line">group 14</div>
<div class="line">lifetime 3600</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">crypto isakmp key vpnsecretkey13 address 10.10.10.10</div>
<div class="line">crypto isakmp key vpnsecretkey23 address 10.10.10.20</div>
<div class="line"> </div>
<div class="line">crypto ipsec transform-set ESP-AES256-SHA esp-aes 256 esp-sha-hmac </div>
<div class="line">mode tunnel</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">crypto ipsec profile VPNPROFILE</div>
<div class="line">set transform-set ESP-AES256-SHA</div>
<div class="line"> </div>
<div class="line">ip access-list extended vpn_traff</div>
<div class="line">permit ip 192.168.0.0 0.0.255.255 192.168.0.0 0.0.255.255</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface tunnel 0</div>
<div class="line">ip address 192.168.2.69 255.255.255.254</div>
<div class="line">tunnel source e0/0</div>
<div class="line">tunnel mode ipsec ipv4</div>
<div class="line">tunnel protection ipsec profile VPNPROFILE</div>
<div class="line">tunnel destination 10.10.10.10</div>
<div class="line">no shutdown</div>
<div class="line"> </div>
<div class="line">interface tunnel 1</div>
<div class="line">ip address 192.168.2.71 255.255.255.254</div>
<div class="line">tunnel source e0/0</div>
<div class="line">tunnel mode ipsec ipv4</div>
<div class="line">tunnel protection ipsec profile VPNPROFILE</div>
<div class="line">tunnel destination 10.10.10.20</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ip route 10.10.10.10 255.255.255.255 10.10.10.31</div>
<div class="line">ip route 10.10.10.20 255.255.255.255 10.10.10.31</div>
<div class="line"> </div>
<div class="line">router ospf 1</div>
<div class="line">neighbor 192.168.2.1</div>
<div class="line">neighbor 192.168.2.2</div>
<div class="line">exit</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md125"></a>
Vlan Access Control (incomplete)</h1>
<p >I use access control to enhance security by preventing unauthorised traffic traveling between VLANs.</p>
<p >All VLANs will be unable route to the management VLAN.</p>
<h2><a class="anchor" id="autotoc_md126"></a>
Main Site</h2>
<h3><a class="anchor" id="autotoc_md127"></a>
Vlan 10 Main</h3>
<div class="fragment"><div class="line">ip access-list ex vlan10_filter</div>
<div class="line">10 permit   ip 192.168.10.0  0.0.0.127  192.168.10.0    0.0.0.127</div>
<div class="line">20 permit   ip 192.168.10.0  0.0.0.127  192.168.10.128  0.0.0.127</div>
<div class="line">30 permit   ip 192.168.10.0  0.0.0.127  192.168.60.0    0.0.0.255</div>
<div class="line">40 permit   ip 192.168.10.0  0.0.0.127  192.168.70.0    0.0.0.255</div>
<div class="line">50 permit   tcp 192.168.10.0 0.0.0.127  192.168.30.0   0.0.0.127 established</div>
<div class="line"> </div>
<div class="line">1000 deny   ip any 192.168.0.0 0.0.255.255</div>
<div class="line">2000 permit ip 192.168.10.0 0.0.0.255 any</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md128"></a>
Vlan 20 Main</h3>
<div class="fragment"><div class="line">ip access-list ex vlan20_filter</div>
<div class="line">10 permit   ip 192.168.20.0  0.0.1.255  192.168.20.0   0.0.1.255</div>
<div class="line">20 permit   ip 192.168.20.0  0.0.1.255  192.168.22.0   0.0.0.255</div>
<div class="line">30 permit   ip 192.168.20.0  0.0.1.255  192.168.60.0   0.0.0.255</div>
<div class="line">40 permit   tcp 192.168.20.0 0.0.1.255  192.168.30.0   0.0.0.127 established</div>
<div class="line"> </div>
<div class="line">1000 deny     ip any 192.168.0.0 0.0.255.255</div>
<div class="line">2000 permit   ip 192.168.20.0 0.0.0.255 any</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md129"></a>
Vlan 30 Main</h3>
<p >vlan 30 can establish ssh connections </p><div class="fragment"><div class="line">ip access-list ex vlan30_filter</div>
<div class="line">10 permit   ip 192.168.30.0  0.0.0.127  192.168.30.0    0.0.0.127</div>
<div class="line">20 permit   ip 192.168.30.0  0.0.0.127  192.168.30.128  0.0.0.127</div>
<div class="line"> </div>
<div class="line">130 permit   tcp 192.168.30.0 0.0.0.127  192.168.10.0    0.0.0.127 eq 22</div>
<div class="line">140 permit   tcp 192.168.30.0 0.0.0.127  192.168.10.128  0.0.0.127 eq 22</div>
<div class="line">150 permit   tcp 192.168.30.0 0.0.0.127  192.168.20.0    0.0.1.255 eq 22</div>
<div class="line">160 permit   tcp 192.168.30.0 0.0.0.127  192.168.22.0    0.0.0.255 eq 22</div>
<div class="line">170 permit   tcp 192.168.30.0 0.0.0.127  192.168.40.0    0.0.0.127 eq 22</div>
<div class="line">180 permit   tcp 192.168.30.0 0.0.0.127  192.168.40.128  0.0.0.127 eq 22</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">1000 deny     ip any 192.168.0.0 0.0.255.255</div>
<div class="line">2000 permit   ip 192.168.30.0 0.0.0.255 any</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md130"></a>
Vlan 40 Main</h3>
<div class="fragment"><div class="line">ip access-list ex vlan40_filter</div>
<div class="line">10 permit   ip 192.168.40.0  0.0.0.127  192.168.40.0    0.0.0.127</div>
<div class="line">20 permit   ip 192.168.40.0  0.0.0.127  192.168.40.128  0.0.0.127</div>
<div class="line">30 permit   ip 192.168.40.0  0.0.0.127  192.168.60.0    0.0.0.255</div>
<div class="line">40 permit   ip 192.168.40.0  0.0.0.127  192.168.70.0    0.0.0.255</div>
<div class="line">50 permit   tcp 192.168.40.0 0.0.0.127  192.168.30.0   0.0.0.127 established</div>
<div class="line"> </div>
<div class="line">1000 deny     ip any 192.168.0.0 0.0.255.255</div>
<div class="line">2000 permit   ip 192.168.40.0 0.0.0.255 any</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md131"></a>
web_server_access</h3>
<p >outgoing </p><div class="fragment"><div class="line">1000 permit tcp any any eq 443</div>
<div class="line">2000 permit tcp any any eq www</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md132"></a>
dns_server_access</h3>
<p >outgoing </p><div class="fragment"><div class="line">1000 permit ip 192.168.0.0 0.0.255.255</div>
<div class="line">deny any any </div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md133"></a>
aaa_server_access</h3>
<p >outgoing </p><div class="fragment"><div class="line">1000 permit ip 192.168.0.0 0.0.255.255</div>
<div class="line">deny any any </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md134"></a>
management_server_access</h3>
<p >outgoing </p><div class="fragment"><div class="line">100 permit ip 192.168.30.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">1000 deny     ip any 192.168.0.0 0.0.255.255</div>
<div class="line">2000 permit   ip 192.168.30.0 0.0.0.255 any</div>
</div><!-- fragment --><div class="fragment"><div class="line">ip access-list ex vlan_filter</div>
<div class="line">deny    ip 192.168.10.0 0.0.0.255 192.168.20.0 0.0.1.255</div>
<div class="line">deny    ip 192.168.10.0 0.0.0.255 192.168.22.0 0.0.0.255</div>
<div class="line">deny    ip 192.168.10.0 0.0.0.255 192.168.30.0 0.0.0.255</div>
<div class="line">deny    ip 192.168.10.0 0.0.0.255 192.168.40.0 0.0.0.255</div>
<div class="line">permit  ip 192.168.10.0 0.0.0.255 192.168.60.0 0.0.0.255</div>
<div class="line">permit  ip 192.168.10.0 0.0.0.255 192.168.70.0 0.0.0.255</div>
<div class="line">deny    ip 192.168.10.0 0.0.1.255 192.168.80.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">deny ip   192.168.20.0 0.0.1.255 192.168.10.0 0.0.0.255</div>
<div class="line">deny ip   192.168.20.0 0.0.1.255 192.168.30.0 0.0.0.255</div>
<div class="line">deny ip   192.168.20.0 0.0.1.255 192.168.40.0 0.0.0.255</div>
<div class="line">permit ip 192.168.20.0 0.1.0.255 192.168.60.0 0.0.0.255</div>
<div class="line">deny ip   192.168.20.0 0.0.1.255 192.168.70.0 0.0.0.255</div>
<div class="line">deny ip   192.168.20.0 0.0.1.255 192.168.80.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">deny ip   192.168.22.0 0.0.0.255 192.168.10.0 0.0.0.255</div>
<div class="line">deny ip   192.168.22.0 0.0.0.255 192.168.30.0 0.0.0.255</div>
<div class="line">deny ip   192.168.22.0 0.0.0.255 192.168.40.0 0.0.0.255</div>
<div class="line">permit ip 192.168.22.0 0.0.0.255 192.168.60.0 0.0.0.255</div>
<div class="line">deny ip   192.168.22.0 0.0.0.255 192.168.70.0 0.0.0.255</div>
<div class="line">deny ip   192.168.22.0 0.0.0.255 192.168.80.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.10.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.20.0 0.0.1.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.22.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.40.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.50.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.60.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.70.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.255 192.168.80.0 0.0.0.255</div>
<div class="line">deny ip 192.168.30.0 0.0.0.127 any log</div>
<div class="line"> </div>
<div class="line">deny ip   192.168.40.0 0.0.0.255 192.168.20.0 0.0.1.255</div>
<div class="line">deny ip   192.168.40.0 0.0.0.255 192.168.22.0 0.0.0.255</div>
<div class="line">deny ip   192.168.40.0 0.0.0.255 192.168.30.0 0.0.0.255</div>
<div class="line">permit ip 192.168.40.0 0.0.0.255 192.168.60.0 0.0.0.255</div>
<div class="line">permit ip 192.168.40.0 0.0.0.255 192.168.70.0 0.0.0.255</div>
<div class="line">deny ip   192.168.40.0 0.0.0.255 192.168.80.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">deny ip 192.168.70.0 0.0.0.255 192.168.20.0 0.0.1.255</div>
<div class="line">deny ip 192.168.70.0 0.0.0.255 192.168.22.0 0.0.0.255</div>
<div class="line">deny ip 192.168.70.0 0.0.0.255 192.168.30.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">deny ip 192.168.80.0 0.0.0.255 192.168.20.0 0.0.1.255</div>
<div class="line">deny ip 192.168.80.0 0.0.0.255 192.168.22.0 0.0.0.255</div>
<div class="line">deny ip 192.168.80.0 0.0.0.255 192.168.30.0 0.0.0.255</div>
<div class="line"> </div>
<div class="line">permit udp 192.168.30.0 0.0.0.127 ip any eq ntp</div>
<div class="line">permit ip any any</div>
<div class="line"> </div>
<div class="line">ip access-list ex service_filter</div>
<div class="line">permit ip 192.168.30.0 0.0.0.255 any</div>
<div class="line">permit tcp any host 192.168.60.251 eq www</div>
<div class="line">permit udp 192.168.0.0 0.0.255.255 host 192.168.60.250 eq domain</div>
<div class="line">deny any any</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md135"></a>
Switch Security</h1>
<p >I enable port security. For each port I use the default of max 1 mac address and leave the default shutdown violation. This prevents MAC flooding. There are no ip phones to share access ports. I enable DHCP snooping which prevents hosts from acting like a DHCP server. I enable DAI to ensure ARP traffic is correct for static and DHCP address assignments. Additionally I assign unused ports to an unused vlan, disable dtp, assign access and shutdown.</p>
<h3><a class="anchor" id="autotoc_md136"></a>
SW1 Config</h3>
<div class="fragment"><div class="line">ip dhcp snooping vlan 10,20,40,80</div>
<div class="line">no ip dhcp snoop info opt</div>
<div class="line">ip dhcp snooping</div>
<div class="line"> </div>
<div class="line">arp access-list ARP_ACL</div>
<div class="line">permit ip host 192.168.10.124 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.10.125 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.10.126 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.21.252 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.21.253 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.21.254 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.40.124 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.40.125 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.40.126 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.80.252 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.80.253 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.80.254 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 10</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 20</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 40</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 80</div>
<div class="line"> </div>
<div class="line">ip arp inspection vlan 10,20,40,80</div>
<div class="line">interface r e0/1,e1/1,e1/2,e1/3</div>
<div class="line">switchport port-s</div>
<div class="line"> </div>
<div class="line">interface r e2/0,e2/1,e2/2,e2/3</div>
<div class="line">switchport port-s</div>
<div class="line"> </div>
<div class="line">interface r e0/3,e1/0,e0/2</div>
<div class="line">ip dhcp snooping trust</div>
<div class="line">ip arp inspection trust</div>
<div class="line"> </div>
<div class="line">interface range ethernet 3/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md137"></a>
SW2 Config</h3>
<div class="fragment"><div class="line">ip dhcp snooping vlan 10,20,40,80</div>
<div class="line">no ip dhcp snoop info opt</div>
<div class="line">ip dhcp snooping</div>
<div class="line">ip arp inspection vlan 10,20,40,80</div>
<div class="line"> </div>
<div class="line">arp access-list ARP_ACL</div>
<div class="line">permit ip host 192.168.10.124 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.10.125 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.10.126 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.21.252 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.21.253 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.21.254 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.40.124 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.40.125 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.40.126 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.80.252 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.80.253 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.80.254 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 10</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 20</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 40</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 80</div>
<div class="line"> </div>
<div class="line">interface r e1/2,e0/1,e1/0</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface r e1/3,e2/0,e2/1,e2/3</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface e1/1</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface e2/2</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface r e0/3,e0/0,e0/2</div>
<div class="line">ip dhcp snooping trust</div>
<div class="line">ip arp inspection trust</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface range ethernet 3/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md138"></a>
SW5 Config</h3>
<div class="fragment"><div class="line">ip dhcp snooping vlan 10,20,40,80</div>
<div class="line">no ip dhcp snoop info opt</div>
<div class="line">ip dhcp snooping</div>
<div class="line">ip arp inspection vlan 10,20,40,80</div>
<div class="line"> </div>
<div class="line">arp access-list ARP_ACL</div>
<div class="line">permit ip host 192.168.10.124 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.10.125 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.10.126 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.21.252 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.21.253 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.21.254 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.40.124 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.40.125 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.40.126 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">permit ip host 192.168.80.252 mac host aabb.cc80.0600</div>
<div class="line">permit ip host 192.168.80.253 mac host aabb.cc80.0700</div>
<div class="line">permit ip host 192.168.80.254 mac host 0000.0c07.ac00</div>
<div class="line"> </div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 10</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 20</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 40</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 80</div>
<div class="line"> </div>
<div class="line">interface r e0/3,e0/2</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface r e1/1,e1/2,e1/3,e2/0</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface e1/0</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface r e0/0,e0/1</div>
<div class="line">ip dhcp snooping trust</div>
<div class="line">ip arp inspection trust</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface range ethernet 2/1 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 3/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md139"></a>
SW6 Config</h3>
<div class="fragment"><div class="line">interface e0/2</div>
<div class="line">switchport port-s</div>
<div class="line">interface r e1/0,e1/3</div>
<div class="line">switchport port-s</div>
<div class="line">interface e0/3</div>
<div class="line">switchport port-s</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface range ethernet 2/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 3/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md140"></a>
SW7 Config</h3>
<div class="fragment"><div class="line">ip dhcp snooping vlan 10,20,40,80</div>
<div class="line">no ip dhcp snoop info opt</div>
<div class="line">ip dhcp snooping</div>
<div class="line">ip arp inspection vlan 10,20,40,80</div>
<div class="line"> </div>
<div class="line">arp access-list ARP_ACL</div>
<div class="line">permit ip host 192.168.10.254 mac host aabb.cc00.0a10</div>
<div class="line">permit ip host 192.168.22.254 mac host aabb.cc00.0a10</div>
<div class="line">permit ip host 192.168.40.124 mac host aabb.cc00.0a10</div>
<div class="line">permit ip host 192.168.80.252 mac host aabb.cc00.0a10</div>
<div class="line"> </div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 10</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 20</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 40</div>
<div class="line">ip arp inspection filter HSRP_ARP_ACL vlan 80</div>
<div class="line"> </div>
<div class="line">interface r e0/1,e0/2,e0/3</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface r e1/1,e1/2,e1/3,e2/0,e2/1</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface e1/0</div>
<div class="line">switchport port-s</div>
<div class="line">ip arp inspection limit rate 100</div>
<div class="line"> </div>
<div class="line">interface e0/0</div>
<div class="line">ip dhcp snooping trust</div>
<div class="line">ip arp inspection trust</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface range ethernet 2/2 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 3/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md141"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">interface range ethernet 1/3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 3/1 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 4/1 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 5/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md142"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">interface range ethernet 2/2 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 3/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 4/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
<div class="line">interface range ethernet 5/0 - 3</div>
<div class="line">    switchport mode access</div>
<div class="line">    switchport access vlan 911</div>
<div class="line">    switchport nonegotiate</div>
<div class="line">    shutdown</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md143"></a>
OSPF Inter-Site</h1>
<p >In order for OSPF to function over the IPSec additional configuration is needed. I manually define the neighbour. This means unicast traffic will be used to form a neighbour relationship.</p>
<h3><a class="anchor" id="autotoc_md144"></a>
R1 Config</h3>
<div class="fragment"><div class="line">router os 1</div>
<div class="line">neigh 192.168.2.3</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md145"></a>
R2 Config</h3>
<div class="fragment"><div class="line">router os 1</div>
<div class="line">neigh 192.168.2.3</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md146"></a>
R3 Config</h3>
<div class="fragment"><div class="line">router os 1</div>
<div class="line">neigh 192.168.2.1</div>
<div class="line">neigh 192.168.2.2</div>
<div class="line">exit</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md147"></a>
NTP</h1>
<p >I ensure minimal discrepancy in the time reported by my LAN devices. For this, I configure R1 to sync to an internet ntp server. The rest of the devices I configure to sync to R1 first and 1.1.1.1 if R1 fails. First I configure the devices to have the correct timezone.</p>
<h3><a class="anchor" id="autotoc_md148"></a>
R1 Config</h3>
<div class="fragment"><div class="line">clock timezone GMT 0</div>
<div class="line">clock summer-time BST recurring last Sun Mar 1:00 last Sun Oct 2:00</div>
<div class="line">ntp authenticate</div>
<div class="line">ntp authentication-key 1 md5 outoftime</div>
<div class="line">ntp trusted-key 1</div>
<div class="line">ntp server 1.1.1.1</div>
<div class="line">ntp master</div>
<div class="line">ntp update-calendar</div>
<div class="line">ntp source l0</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md149"></a>
R2+R3 Config</h3>
<div class="fragment"><div class="line">clock timezone GMT 0</div>
<div class="line">clock summer-time BST recurring last Sun Mar 1:00 last Sun Oct 2:00</div>
<div class="line">ntp authenticate</div>
<div class="line">ntp authentication-key 1 md5 outoftime</div>
<div class="line">ntp trusted-key 1</div>
<div class="line">ntp server 192.168.2.1 key 1 prefer</div>
<div class="line">ntp server 1.1.1.1</div>
<div class="line">ntp update-calendar</div>
<div class="line">ntp source l0</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md150"></a>
Switchs Config</h3>
<div class="fragment"><div class="line">clock timezone GMT 0</div>
<div class="line">clock summer-time BST recurring last Sun Mar 1:00 last Sun Oct 2:00</div>
<div class="line">ntp authenticate</div>
<div class="line">ntp authentication-key 1 md5 outoftime</div>
<div class="line">ntp trusted-key 1</div>
<div class="line">ntp server 192.168.2.1 key 1 prefer</div>
<div class="line">ntp server 1.1.1.1</div>
<div class="line">ntp update-calendar</div>
<div class="line">ntp source vlan 30</div>
</div><!-- fragment --> <div class="fragment"><div class="line">clock timezone GMT 0</div>
<div class="line">clock summer-time BST recurring last Sun Mar 1:00 last Sun Oct 2:00</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md151"></a>
IPv6 Addressing + HSRP v2</h1>
<p >Version 2 is the HSRP version that supports ipv6. </p>
<h3><a class="anchor" id="autotoc_md152"></a>
R1 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line"> </div>
<div class="line">interface g1</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:ff::fff5/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface l0</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:3::ff1/128</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface g2</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:ff::fffe/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface g3</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:ff::fff1/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md153"></a>
R2 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line"> </div>
<div class="line">interface e0/1</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fffa/127</div>
<div class="line"> </div>
<div class="line">interface l0</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:3::ff2/128</div>
<div class="line"> </div>
<div class="line">interface e0/0</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fff3/127</div>
<div class="line">no shutdown</div>
<div class="line"> </div>
<div class="line">interface e0/2</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::ffef/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md154"></a>
R3 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line"> </div>
<div class="line">interface e0/0</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fffc/127 </div>
<div class="line"> </div>
<div class="line">interface l0</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:23::ff3/128</div>
<div class="line"> </div>
<div class="line">interface e0/1.10</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:21::1/64</div>
<div class="line"> </div>
<div class="line">interface e0/1.20</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:22::1/64</div>
<div class="line"> </div>
<div class="line">interface e0/1.30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:23::1/120</div>
<div class="line"> </div>
<div class="line">interface e0/1.40</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:24::1/64</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md155"></a>
SW1 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0003::11/120</div>
<div class="line">exit</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md156"></a>
SW2 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0003::12/120</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md157"></a>
SW3 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line"> </div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0003::13/120</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0003::1/120</div>
<div class="line"> </div>
<div class="line">interface vlan 10</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0001::3/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0001::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 20</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0002::3/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0002::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 40</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0004::3/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0004::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 60</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0006::3/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0006::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 70</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0007::3/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0007::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 80</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0008::3/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0008::1/64</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface e4/0</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fff4/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line">interface e1/2</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::ffee/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md158"></a>
SW4 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0003::14/120</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0003::1/120</div>
<div class="line"> </div>
<div class="line">interface vlan 10</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0001::4/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0001::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 20</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0002::4/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0002::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 40</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0004::4/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0004::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 60</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0006::4/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0006::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 70</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0007::4/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0007::1/64</div>
<div class="line"> </div>
<div class="line">interface vlan 80</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0008::4/64</div>
<div class="line">standby version 2</div>
<div class="line">standby 1 timers msec 200 msec 650</div>
<div class="line">standby 1 priority 111</div>
<div class="line">standby 1 preempt delay reload 60</div>
<div class="line">standby 1 ipv6 2001:db8:0:0008::1/64</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">interface e1/3</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fff2/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
<div class="line">interface e1/3</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:00ff::fff0/127</div>
<div class="line">no shutdown</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md159"></a>
SW5 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0003::15/120</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md160"></a>
SW6 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:0003::16/120</div>
<div class="line">exit</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md161"></a>
SW7 Config</h3>
<div class="fragment"><div class="line">ipv6 unicast-routing</div>
<div class="line">interface vlan 30</div>
<div class="line">ipv6 enable</div>
<div class="line">ipv6 add 2001:db8:0:23::17/120</div>
<div class="line">exit</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md162"></a>
IPv6 Static routes</h1>
<p >Note IPv6 traffic between the two sites is not encrypted like IPv4 is. This is beyond CCNA. In reality this would be a major security issue. </p>
<h3><a class="anchor" id="autotoc_md163"></a>
R1</h3>
<div class="fragment"><div class="line">ipv6 route 0::/0 g2 2001:db8:0:ff::ffff</div>
<div class="line">ipv6 route 2001:db8::/60 g1 2001:db8:0:ff::fff4</div>
<div class="line">ipv6 route 2001:db8::/60 g3 2001:db8:0:ff::fff0 9</div>
<div class="line"> </div>
<div class="line">ipv6 route 2001:db8:0:03::ff2/128 g1 2001:db8:0:ff::fff4</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md164"></a>
R2</h3>
<div class="fragment"><div class="line">ipv6 route 0::/0 e0/1 2001:db8:0:ff::fffd</div>
<div class="line">ipv6 route 2001:db8::/60 e0/0 2001:db8:0:ff::fff2</div>
<div class="line">ipv6 route 2001:db8::/60 e0/2 2001:db8:0:ff::ffee 9</div>
<div class="line"> </div>
<div class="line">ipv6 route 2001:db8:0:03::ff1/128 e0/0 2001:db8:0:ff::fff2</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md165"></a>
R3</h3>
<div class="fragment"><div class="line">ipv6 route 0::/0 e0/0 2001:db8:0:00ff::fffb</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md166"></a>
SW1</h3>
<div class="fragment"><div class="line">ipv6 route ::0/0 2001:DB8:0:3::1</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md167"></a>
SW2</h3>
<div class="fragment"><div class="line">ipv6 route ::0/0 2001:DB8:0:3::1</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md168"></a>
SW3</h3>
<div class="fragment"><div class="line">ipv6 route 0::/0 e4/0 2001:db8:0:ff::fff5</div>
<div class="line">ipv6 route 0::/0 e1/2 2001:db8:0:ff::ffef 9</div>
<div class="line">ipv6 route 2001:db8:0:03::ff1/128 e4/0 2001:db8:0:ff::fff5</div>
<div class="line">ipv6 route 2001:db8:0:03::ff2/128 2001:db8:0:3::14</div>
<div class="line">ipv6 route 2001:db8:0:ff::fffc/127 2001:db8:0:3::14</div>
<div class="line">ipv6 route 2001:db8:0:ff::fff2/127 2001:db8:0:3::14</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md169"></a>
SW4</h3>
<div class="fragment"><div class="line">ipv6 route 0::/0 e1/3 2001:db8:0:00ff::fff3</div>
<div class="line">ipv6 route 0::/0 e2/1 2001:db8:0:ff::fff1 9</div>
<div class="line">ipv6 route 2001:db8:0:03::ff1/128 2001:db8:0:3::13</div>
<div class="line">ipv6 route 2001:db8:0:03::ff2/128 e1/3 2001:db8:0:ff::fff3</div>
<div class="line">ipv6 route 2001:db8:0:ff::fffe/127 2001:db8:0:3::13</div>
<div class="line">ipv6 route 2001:db8:0:ff::fff4/127 2001:db8:0:3::13</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md170"></a>
SW5</h3>
<div class="fragment"><div class="line">ipv6 route ::0/0 2001:DB8:0:3::1</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md171"></a>
SW6</h3>
<div class="fragment"><div class="line">ipv6 route ::0/0 2001:DB8:0:3::1</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md172"></a>
SW7</h3>
<div class="fragment"><div class="line">ipv6 route ::0/0 2001:DB8:0:23::1</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md173"></a>
SSH</h1>
<p >All network devices have a hostname and domain name TapeItUp. The password is not secure enough to be used in a non lab env.</p>
<h3><a class="anchor" id="autotoc_md174"></a>
Debian Client Connect</h3>
<div class="fragment"><div class="line">ssh -o KexAlgorithms=+diffie-hellman-group14-sha1 -o MACs=hmac-sha1 -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa 2001:db8:0:3::ff2 -l lab</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md175"></a>
Router and Switch Config</h3>
<div class="fragment"><div class="line">username lab privilege 15 secret bal</div>
<div class="line">username auto privilege 15 secret otua</div>
<div class="line">service password-encryption</div>
<div class="line"> </div>
<div class="line">crypto key generate rsa modulus 2048 label ssh</div>
<div class="line">ip ssh rsa keypair-name ssh</div>
<div class="line">ip ssh version 2</div>
<div class="line">ip ssh server algorithm encryption aes256-ctr</div>
<div class="line">ip ssh server algorithm mac hmac-sha1</div>
<div class="line"> </div>
<div class="line">line vty 0 4</div>
<div class="line">transp in ssh</div>
<div class="line">login local</div>
<div class="line">exec-timeout 0 0</div>
<div class="line">exit</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md176"></a>
Ansible Example</h1>
<p >For an initial demo of ansible I create a SSH playbook to change the banner on the device. The local user authentication is used. When I run the playbook with ansible it sucessfully changes the banner on R2. </p>
<h3><a class="anchor" id="autotoc_md177"></a>
Playbook testssh.yaml</h3>
<div class="fragment"><div class="line">---</div>
<div class="line">- name: play1</div>
<div class="line">  hosts: testssh</div>
<div class="line">  gather_facts: no</div>
<div class="line">  tasks:</div>
<div class="line">    - name: Print connection details</div>
<div class="line">      debug:</div>
<div class="line">        msg: &quot;Connecting to {{ ansible_host }} with user {{ ansible_user }} and password {{ ansible_password }}&quot;</div>
<div class="line"> </div>
<div class="line">    - name: Add Banner using ios_banner via SSH</div>
<div class="line">      cisco.ios.ios_banner:</div>
<div class="line">        banner: login</div>
<div class="line">        text: this was configured with ansible via ssh</div>
<div class="line">        state: present</div>
<div class="line">    - name: Add Banner using ios_banner via SSH</div>
<div class="line">      cisco.ios.ios_banner:</div>
<div class="line">        banner: login</div>
<div class="line">        text: this was configured with ansible via ssh</div>
<div class="line">        state: present</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md178"></a>
inventory.yaml</h3>
<div class="fragment"><div class="line">---</div>
<div class="line">all:</div>
<div class="line">  children:</div>
<div class="line">    testnetconf:</div>
<div class="line">      hosts:</div>
<div class="line">        2001:db8:0:3::ff1:</div>
<div class="line">          ansible_host: 2001:db8:0:3::ff1</div>
<div class="line">          ansible_user: auto</div>
<div class="line">          ansible_password: otua</div>
<div class="line">          ansible_connection: netconf</div>
<div class="line">          ansible_network_os: ios</div>
<div class="line">          netconf_port: 830</div>
<div class="line">          ansible_become: yes</div>
<div class="line">          ansible_become_method: enable</div>
<div class="line">          ansible_become_password: otua</div>
<div class="line">    testssh:</div>
<div class="line">      hosts:</div>
<div class="line">        2001:db8:0:3::ff2:</div>
<div class="line">          ansible_host: 2001:db8:0:3::ff1</div>
<div class="line">          ansible_user: auto</div>
<div class="line">          ansible_password: otua</div>
<div class="line">          ansible_connection: network_cli</div>
<div class="line">          ansible_network_os: ios</div>
<div class="line">          ansible_ssh_common_args: &#39;-o StrictHostKeyChecking=no -o KexAlgorithms=+diffie-hellman-group14-sha1 -o MACs=hmac-sha1 -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa&#39;</div>
<div class="line">          ansible_become: yes</div>
<div class="line">          ansible_become_method: enable</div>
<div class="line">          ansible_become_password: otua</div>
<div class="line">    testrestconf:</div>
<div class="line">      hosts:</div>
<div class="line">        2001:db8:0:3::ff1:</div>
<div class="line">          ansible_host: 2001:db8:0:3::ff1</div>
<div class="line">          ansible_user: auto</div>
<div class="line">          ansible_password: otua</div>
<div class="line">          ansible_connection: local</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
